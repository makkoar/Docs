# Jar-in-Jar

Jar-in-Jar — это способ загрузки зависимостей для модов изнутри jar-файлов самих модов. Для этого Jar-in-Jar генерирует метаданные в формате JSON в `META-INF/jarjar/metadata.json` при сборке, содержащие артефакты для загрузки изнутри jar-файла.

Jar-in-Jar — это полностью необязательная система, которую можно включить с помощью `jarJar#enable`. Это включит все зависимости из конфигурации `jarJar` в задачу `jarJar`. Вы можете настроить задачу аналогично другим задачам jar:

```gradle
// В build.gradle

// Включить систему Jar-in-Jar для вашего мода
jarJar.enable()

// Настроить задачу 'jarJar'
// 'all' - классификатор по умолчанию
tasks.named('jarJar') {
    // ...
}
```

## Добавление зависимостей

Вы можете добавить зависимости для включения внутрь вашего jar-файла, используя конфигурацию `jarJar`. Поскольку Jar-in-Jar — это система согласования, все версии должны указывать поддерживаемый диапазон.

```gradle
// В build.gradle
dependencies {
    // Компилируется с использованием и включает самую высокую поддерживаемую версию examplelib
    //   между 2.0 (включительно) и 3.0 (исключительно)
    jarJar(group: 'com.example', name: 'examplelib', version: '[2.0,3.0)')
}
```

Если вам нужно указать точную версию для включения, а не самую высокую поддерживаемую версию в диапазоне, вы можете использовать `jarJar#pin` внутри замыкания зависимости. В этих случаях версия артефакта будет использоваться во время компиляции, а закрепленная версия будет упакована внутрь jar-файла мода.

```gradle
// В build.gradle
dependencies {
    // Компилируется с использованием самой высокой поддерживаемой версии examplelib
    //   между 2.0 (включительно) и 3.0 (исключительно)
    jarJar(group: 'com.example', name: 'examplelib', version: '[2.0,3.0)') {
      // Включает examplelib 2.8.0
      jarJar.pin(it, '2.8.0')
    }
}
```

Вы также можете закрепить диапазон версий, компилируясь при этом с конкретной версией:

```gradle
// В build.gradle
dependencies {
    // Компилируется с использованием examplelib 2.8.0
    jarJar(group: 'com.example', name: 'examplelib', version: '2.8.0') {
      // Включает самую высокую поддерживаемую версию examplelib
      //   между 2.0 (включительно) и 3.0 (исключительно)
      jarJar.pin(it, '[2.0,3.0)')
    }
}

```

### Использование зависимостей времени выполнения

Если вы хотите включить зависимости времени выполнения вашего мода внутрь jar-файла, вы можете вызвать `jarJar#fromRuntimeConfiguration` в вашем скрипте сборки. Если вы решите использовать эту опцию, настоятельно рекомендуется использовать фильтры зависимостей; в противном случае все зависимости — включая Minecraft и NeoForge — также будут упакованы в jar-файл. Для поддержки более гибких выражений конфигурация `dependency` была добавлена в расширение и задачу `jarJar`. С ее помощью вы можете указать шаблоны для включения или исключения из конфигурации:

```gradle
// В build.gradle

// Добавить зависимости времени выполнения в jar
jarJar.fromRuntimeConfiguration()

// ...

jarJar {
    // Включить или исключить зависимости из конфигурации времени выполнения здесь
    dependencies {
        // Исключить любую зависимость, начинающуюся с 'com.google.gson.'
        exclude(dependency('com.google.gson.*'))
    }
}
```

> **Совет:**
> Обычно рекомендуется устанавливать хотя бы один фильтр `include` при использовании `#fromRuntimeConfiguration`.

## Публикация Jar-in-Jar в Maven

В целях архивации NeoGradle поддерживает публикацию артефактов Jar-in-Jar в выбранный Maven, аналогично тому, как это делает [плагин Shadow](https://imperceptiblethoughts.com/shadow/getting-started/). На практике это не полезно и не рекомендуется.

```gradle
// В build.gradle (с подключенным плагином 'maven-publish')

publications {
    mavenJava(MavenPublication) {
        // Добавить стандартные компоненты java и артефакт Jar-in-Jar
        from components.java
        jarJar.component(it)

        // ...
    }
}
```
---
<div align="center"><table><tr><td align="center">Предыдущий раздел<br><a href="./Non-Minecraft%20dependencies.md">Зависимости, не относящиеся к Minecraft</a></td></tr></table></div>
